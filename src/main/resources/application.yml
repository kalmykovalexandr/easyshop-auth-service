# =============================================================================
# EasyShop Auth Service Bootstrap Configuration
# =============================================================================
# This file points the service to the external Config Server.

spring:
  application:
    name: auth-service
  config:
    import: optional:configserver:${CONFIG_SERVER_URI}
  cloud:
    config:
      username: ${CONFIG_SERVER_USER}
      password: ${CONFIG_SERVER_PASSWORD}
      fail-fast: false
      retry:
        initial-interval: 1000
        max-attempts: 6
        max-interval: 2000
        multiplier: 1.1
  profiles:
    active: ${SPRING_PROFILES_ACTIVE}
  mail:
    host: ${MAIL_HOST:localhost}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME:}
    password: ${MAIL_PASSWORD:}
    properties:
      mail:
        smtp:
          auth: ${MAIL_SMTP_AUTH:true}
          starttls:
            enable: ${MAIL_SMTP_STARTTLS:true}
          connectiontimeout: ${MAIL_CONNECTION_TIMEOUT:5000}
          timeout: ${MAIL_TIMEOUT:5000}
          writetimeout: ${MAIL_WRITE_TIMEOUT:5000}

# EasyShop specific configuration
easyshop:
  mail:
    from-email: ${MAIL_FROM_EMAIL:noreply@easyshop.com}
    from-name: ${MAIL_FROM_NAME:EasyShop}
  auth:
    # Email verification code settings (Production-grade defaults)
    verification-code-length: ${VERIFICATION_CODE_LENGTH:8}
    verification-ttl-minutes: ${VERIFICATION_TTL_MINUTES:10}
    verification-max-attempts: ${VERIFICATION_MAX_ATTEMPTS:3}
    verification-resend-cooldown-seconds: ${VERIFICATION_RESEND_COOLDOWN_SECONDS:120}
    reset-token-ttl-minutes: ${RESET_TOKEN_TTL_MINUTES:10}
    trusted-proxies: ${EASYSHOP_TRUSTED_PROXIES:127.0.0.1,::1,0:0:0:0:0:0:0:1}

    # IP-based rate limiting
    verification-ip-rate-limit-enabled: ${VERIFICATION_IP_RATE_LIMIT_ENABLED:true}
    verification-ip-max-attempts: ${VERIFICATION_IP_MAX_ATTEMPTS:10}
    verification-ip-window-minutes: ${VERIFICATION_IP_WINDOW_MINUTES:60}

    rate-limit:
      window-seconds: ${AUTH_RATE_LIMIT_WINDOW_SECONDS:600}
      max-requests: ${AUTH_RATE_LIMIT_MAX_REQUESTS:10}
      paths: ${AUTH_RATE_LIMIT_PATHS:/api/auth/send-verification-code,/api/auth/verify-code,/api/auth/reset-password,/api/auth/register}

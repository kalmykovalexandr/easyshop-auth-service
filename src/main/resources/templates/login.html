<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:attr="lang=${#locale.language}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{login.meta.title.signin}">EasyShop · Sign in</title>
    <link rel="stylesheet" href="/css/login.css">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
<div class="auth-shell" data-auth-root>
    <div class="auth-card"
         data-mode="signin"
         th:attr="data-signin-title=#{login.meta.title.signin},
                 data-register-title=#{login.meta.title.register}">

        <!-- Sign in -->
        <section class="auth-view auth-view--signin" data-view="signin">
            <header class="auth-header">
                <h1 class="auth-title" th:text="#{login.signin.title}">Sign in</h1>
                <p class="auth-subtitle" th:text="#{login.signin.subtitle}">Welcome back! Enter your details to continue.</p>
            </header>

            <form method="post"
                  action="/login"
                  class="auth-form"
                  data-signin-form
                  novalidate
                  th:attr="data-error-email=#{login.errors.emailRequired},
                           data-error-password=#{login.errors.passwordRequired},
                           data-error-fill=#{login.errors.fillAll}">
                <label class="auth-field">
                    <span class="auth-field__label" th:text="#{login.field.email}">E-mail</span>
                    <input class="auth-field__input" type="email" name="username" autocomplete="username" required th:value="${lastUsername}">
                </label>
                <label class="auth-field auth-field--with-toggle">
                    <span class="auth-field__label" th:text="#{login.field.password}">Password</span>
                    <div class="auth-field__control">
                        <input class="auth-field__input" type="password" name="password" autocomplete="current-password" required>
                        <button type="button"
                                class="auth-field__toggle"
                                data-toggle-password
                                th:attr="data-label-show=#{login.password.toggle.show},
                                         data-label-hide=#{login.password.toggle.hide},
                                         aria-label=#{login.password.toggle.show}">
                            <span class="auth-field__toggle-icon" aria-hidden="true"></span>
                            <span class="sr-only" th:text="#{login.password.toggle.show}">Show password</span>
                        </button>
                    </div>
                </label>
                <div class="auth-message auth-message--error"
                     data-signin-error
                     th:if="${loginErrorCode} != null"
                     th:text="${loginErrorCode} == 'disabled' ? #{login.errors.disabled} : #{login.errors.credentials}">
                    Invalid e-mail or password.
                </div>
                <button type="submit" class="auth-button auth-button--primary" th:text="#{login.signin.submit}">Sign in</button>
            </form>

            <div class="auth-meta">
                <button type="button" class="auth-link auth-link--action" data-action="open-forgot"
                        th:text="#{login.actions.forgot}">Forgot password?</button>
            </div>

            <p class="auth-switch">
                <span th:text="#{login.switch.noAccount}">Don’t have an account?</span>
                <button type="button" class="auth-switch__btn" data-action="show-register"
                        th:text="#{login.switch.create}">Create account</button>
            </p>

            <p class="auth-note" th:text="#{login.notice}">By continuing you agree to the Terms of Service.</p>
        </section>

        <!-- Registration -->
        <section class="auth-view auth-view--register" data-view="register" hidden aria-hidden="true">
            <header class="auth-header">
                <h1 class="auth-title" th:text="#{register.title}">Create account</h1>
                <p class="auth-subtitle" th:text="#{register.subtitle}">Let’s get you set up. It only takes a minute.</p>
            </header>

            <form class="auth-form"
                  id="registerForm"
                  data-register-form
                  novalidate
                  th:attr="data-error-email=#{register.errors.email},
                           data-error-password=#{register.errors.password},
                           data-error-mismatch=#{register.errors.mismatch},
                           data-error-generic=#{register.errors.generic},
                           data-success-title=#{register.success.title},
                           data-success-message=#{register.success.message}">
                <label class="auth-field">
                    <span class="auth-field__label" th:text="#{login.field.email}">E-mail</span>
                    <input class="auth-field__input" type="email" name="email" autocomplete="email" required>
                </label>
                <label class="auth-field auth-field--with-toggle">
                    <span class="auth-field__label" th:text="#{login.field.password}">Password</span>
                    <div class="auth-field__control">
                        <input class="auth-field__input" type="password" name="password" autocomplete="new-password" required>
                        <button type="button"
                                class="auth-field__toggle"
                                data-toggle-password
                                th:attr="data-label-show=#{login.password.toggle.show},
                                         data-label-hide=#{login.password.toggle.hide},
                                         aria-label=#{login.password.toggle.show}">
                            <span class="auth-field__toggle-icon" aria-hidden="true"></span>
                            <span class="sr-only" th:text="#{login.password.toggle.show}">Show password</span>
                        </button>
                    </div>
                </label>
                <label class="auth-field auth-field--with-toggle">
                    <span class="auth-field__label" th:text="#{login.field.confirmPassword}">Confirm password</span>
                    <div class="auth-field__control">
                        <input class="auth-field__input" type="password" name="confirmPassword" autocomplete="new-password" required>
                        <button type="button"
                                class="auth-field__toggle"
                                data-toggle-password
                                th:attr="data-label-show=#{login.password.toggle.show},
                                         data-label-hide=#{login.password.toggle.hide},
                                         aria-label=#{login.password.toggle.show}">
                            <span class="auth-field__toggle-icon" aria-hidden="true"></span>
                            <span class="sr-only" th:text="#{login.password.toggle.show}">Show password</span>
                        </button>
                    </div>
                </label>
                <p class="auth-hint" th:text="#{register.password.hint}">Use at least 8 characters with uppercase, lowercase, number and symbol.</p>
                <div class="auth-message auth-message--error" data-register-error hidden aria-hidden="true"></div>
                <button type="submit" class="auth-button auth-button--primary" th:text="#{register.submit}">Create account</button>
            </form>

            <p class="auth-switch">
                <span th:text="#{login.switch.haveAccount}">Already have an account?</span>
                <button type="button" class="auth-switch__btn" data-action="show-signin"
                        th:text="#{login.switch.signin}">Sign in</button>
            </p>

            <p class="auth-note" th:text="#{register.note}">By creating an account you agree to the privacy policy.</p>
        </section>
    </div>
</div>

<!-- OTP verification modal -->
<section class="auth-modal" data-modal="otp" hidden aria-hidden="true">
    <div class="auth-modal__dialog">
        <button type="button" class="auth-modal__close" data-action="close-modal" aria-label="Close"></button>
        <div class="auth-modal__body">
            <h2 class="auth-modal__title" th:text="#{otp.modal.title}">Check your email</h2>
            <p class="auth-modal__text"
               data-otp-description
               th:text="#{otp.modal.description}"
               th:attr="data-template=#{otp.modal.description}">Enter the 8-digit code we sent to your email.</p>
            <label class="auth-field auth-field--center">
                <span class="auth-field__label sr-only" th:text="#{otp.modal.label}">Verification code</span>
                <input class="auth-field__input auth-field__input--otp"
                       type="text"
                       inputmode="numeric"
                       maxlength="8"
                       data-otp-input
                       th:attr="placeholder=#{otp.modal.placeholder}">
            </label>
            <div class="auth-message" data-otp-message hidden aria-hidden="true"></div>
        </div>
        <div class="auth-modal__actions">
            <button type="button" class="auth-button auth-button--primary" data-action="otp-submit"
                    th:text="#{otp.modal.confirm}">Confirm</button>
            <button type="button" class="auth-button auth-button--secondary" data-action="otp-resend"
                    th:text="#{otp.modal.resend}">Send again</button>
        </div>
    </div>
</section>

<!-- Registration success -->
<section class="auth-modal" data-modal="register-success" hidden aria-hidden="true">
    <div class="auth-modal__dialog">
        <button type="button" class="auth-modal__close" data-action="close-modal" aria-label="Close"></button>
        <div class="auth-modal__body auth-modal__body--center">
            <div class="auth-modal__status auth-modal__status--success"></div>
            <h2 class="auth-modal__title" th:text="#{register.success.titleShort}">Account confirmed</h2>
            <p class="auth-modal__text" th:text="#{register.success.subtitle}">Your account is ready. Sign in to start shopping.</p>
        </div>
        <div class="auth-modal__actions">
            <button type="button" class="auth-button auth-button--primary" data-action="go-signin"
                    th:text="#{register.success.button.signin}">Sign in</button>
            <a class="auth-button auth-button--secondary" data-action="go-home" th:href="@{/}"
               th:text="#{register.success.button.store}">Go to store</a>
        </div>
    </div>
</section>

<!-- Forgot password step 1 -->
<section class="auth-modal" data-modal="forgot-email" hidden aria-hidden="true">
    <div class="auth-modal__dialog">
        <button type="button" class="auth-modal__close" data-action="close-modal" aria-label="Close"></button>
        <div class="auth-modal__body">
            <h2 class="auth-modal__title" th:text="#{forgot.email.title}">Recover password</h2>
            <p class="auth-modal__text" th:text="#{forgot.email.subtitle}">Enter your e-mail and we will send you a verification code.</p>
            <label class="auth-field auth-field--center">
                <span class="auth-field__label sr-only" th:text="#{login.field.email}">E-mail</span>
                <input class="auth-field__input" type="email" data-forgot-email-input autocomplete="email">
            </label>
            <div class="auth-message" data-forgot-email-message hidden aria-hidden="true"></div>
        </div>
        <div class="auth-modal__actions">
            <button type="button" class="auth-button auth-button--primary" data-action="forgot-send"
                    th:text="#{forgot.email.submit}">Send code</button>
        </div>
    </div>
</section>

<!-- Forgot password step 2 -->
<section class="auth-modal" data-modal="forgot-code" hidden aria-hidden="true">
    <div class="auth-modal__dialog">
        <button type="button" class="auth-modal__close" data-action="close-modal" aria-label="Close"></button>
        <div class="auth-modal__body">
            <h2 class="auth-modal__title" th:text="#{forgot.code.title}">Enter code</h2>
            <p class="auth-modal__text"
               data-forgot-code-description
               th:text="#{forgot.code.subtitle}"
               th:attr="data-template=#{forgot.code.subtitle}">Enter the 8-digit code we sent to your e-mail.</p>
            <label class="auth-field auth-field--center">
                <span class="auth-field__label sr-only" th:text="#{otp.modal.label}">Verification code</span>
                <input class="auth-field__input auth-field__input--otp"
                       type="text"
                       inputmode="numeric"
                       maxlength="8"
                       data-forgot-code-input
                       th:attr="placeholder=#{otp.modal.placeholder}">
            </label>
            <div class="auth-message" data-forgot-code-message hidden aria-hidden="true"></div>
        </div>
        <div class="auth-modal__actions">
            <button type="button" class="auth-button auth-button--primary" data-action="forgot-verify"
                    th:text="#{forgot.code.submit}">Verify code</button>
            <button type="button" class="auth-button auth-button--secondary" data-action="forgot-resend"
                    th:text="#{otp.modal.resend}">Send again</button>
        </div>
    </div>
</section>

<!-- Forgot password step 3 -->
<section class="auth-modal" data-modal="forgot-reset" hidden aria-hidden="true">
    <div class="auth-modal__dialog">
        <button type="button" class="auth-modal__close" data-action="close-modal" aria-label="Close"></button>
        <div class="auth-modal__body">
            <h2 class="auth-modal__title" th:text="#{forgot.reset.title}">Create new password</h2>
            <p class="auth-modal__text" th:text="#{forgot.reset.subtitle}">Choose a new password for your account.</p>
            <label class="auth-field auth-field--center auth-field--with-toggle">
                <span class="auth-field__label" th:text="#{forgot.reset.field.password}">New password</span>
                <div class="auth-field__control">
                    <input class="auth-field__input" type="password" data-forgot-password-input autocomplete="new-password">
                    <button type="button"
                            class="auth-field__toggle auth-field__toggle--hidden"
                            data-toggle-password
                            th:attr="data-label-show=#{login.password.toggle.show},
                                     data-label-hide=#{login.password.toggle.hide},
                                     aria-label=#{login.password.toggle.show}">
                        <span class="auth-field__toggle-icon" aria-hidden="true"></span>
                        <span class="sr-only" th:text="#{login.password.toggle.show}">Show password</span>
                    </button>
                </div>
            </label>
            <label class="auth-field auth-field--center auth-field--with-toggle">
                <span class="auth-field__label" th:text="#{forgot.reset.field.confirm}">Confirm password</span>
                <div class="auth-field__control">
                    <input class="auth-field__input" type="password" data-forgot-confirm-input autocomplete="new-password">
                    <button type="button"
                            class="auth-field__toggle auth-field__toggle--hidden"
                            data-toggle-password
                            th:attr="data-label-show=#{login.password.toggle.show},
                                     data-label-hide=#{login.password.toggle.hide},
                                     aria-label=#{login.password.toggle.show}">
                        <span class="auth-field__toggle-icon" aria-hidden="true"></span>
                        <span class="sr-only" th:text="#{login.password.toggle.show}">Show password</span>
                    </button>
                </div>
            </label>
            <p class="auth-hint auth-hint--center" th:text="#{register.password.hint}">Use at least 8 characters with uppercase, lowercase, number and symbol.</p>
            <div class="auth-message" data-forgot-reset-message hidden aria-hidden="true"></div>
        </div>
        <div class="auth-modal__actions">
            <button type="button" class="auth-button auth-button--primary" data-action="forgot-complete"
                    th:text="#{forgot.reset.submit}">Save password</button>
        </div>
    </div>
</section>

<!-- Forgot password success -->
<section class="auth-modal" data-modal="forgot-success" hidden aria-hidden="true">
    <div class="auth-modal__dialog">
        <button type="button" class="auth-modal__close" data-action="close-modal" aria-label="Close"></button>
        <div class="auth-modal__body auth-modal__body--center">
            <div class="auth-modal__status auth-modal__status--success"></div>
            <h2 class="auth-modal__title" th:text="#{forgot.success.title}">Password updated</h2>
            <p class="auth-modal__text" th:text="#{forgot.success.subtitle}">You can now sign in with your new password.</p>
        </div>
        <div class="auth-modal__actions">
            <button type="button" class="auth-button auth-button--primary" data-action="go-signin"
                    th:text="#{forgot.success.button}">Sign in</button>
        </div>
    </div>
</section>

<!-- Modal data messages -->
<div hidden
     data-i18n-store
     th:attr="data-otp-error=#{otp.modal.error},
              data-otp-resend-success=#{otp.modal.resend.success},
              data-otp-resend-wait=#{otp.modal.resend.wait},
              data-otp-disabled=#{otp.modal.disabled},
              data-forgot-email-error=#{forgot.email.error},
              data-forgot-code-error=#{forgot.code.error},
              data-forgot-password-error=#{forgot.reset.error},
              data-forgot-password-mismatch=#{forgot.reset.mismatch},
              data-forgot-password-weak=#{forgot.reset.weak},
              data-generic-error=#{common.error.generic}">
</div>

<script src="/js/login.js" defer></script>
</body>
</html>
